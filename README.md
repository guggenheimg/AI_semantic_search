## üîç –í–≤–µ–¥–µ–Ω–∏–µ

**Visual RAG Agent** ‚Äî —ç—Ç–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –∞–≥–µ–Ω—Ç, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–π —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ø–æ PDF-–¥–æ–∫—É–º–µ–Ω—Ç–∞–º —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∑–Ω–∞–Ω–∏–π. –í –æ—Å–Ω–æ–≤–µ —Å–∏—Å—Ç–µ–º—ã –ª–µ–∂–∏—Ç –ø–æ–¥—Ö–æ–¥ **Visual Retrieval-Augmented Generation**, –æ–±—ä–µ–¥–∏–Ω—è—é—â–∏–π –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏, —Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –±–∞–∑–µ **Vespa** –∏ –≥–µ–Ω–µ—Ä–∞—Ç–∏–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –º–æ–¥–µ–ª–∏ **Gemma**.

–ü—Ä–æ–µ–∫—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∑–Ω–∞–Ω–∏–π –∏–∑ PDF-–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π, –Ω–∞—É—á–Ω—ã—Ö –ø—É–±–ª–∏–∫–∞—Ü–∏–π –∏ –¥—Ä—É–≥–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å –≤–∏–∑—É–∞–ª—å–Ω—ã–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º. –ù–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –∞–≥–µ–Ω—Ç:
1. –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö —Å –ø–æ–º–æ—â—å—é –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞,
2. –∏–∑–≤–ª–µ–∫–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —ç—Ç–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü,
3. –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏—Ö —Å –ø–æ–º–æ—â—å—é –º—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω–æ–π LLM, —á—Ç–æ–±—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ—á–Ω—ã–π –∏ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç.

–≠—Ç–æ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ –≤ –∑–∞–¥–∞—á–∞—Ö –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞, –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã—Ö –ø–æ–º–æ—â–Ω–∏–∫–æ–≤ –∏ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Å–∏—Å—Ç–µ–º.

# üß† Visual RAG Agent with Vespa & ColPali

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π **AI-–∞–≥–µ–Ω—Ç–∞ –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ PDF-–¥–æ–∫—É–º–µ–Ω—Ç–∞–º**, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ **Visual RAG** (Retrieval-Augmented Generation). –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –æ—Ç ColPali –∏ –ø–æ–∏—Å–∫–æ–≤—ã–π –¥–≤–∏–∂–æ–∫ Vespa. –ê–≥–µ–Ω—Ç —Å–ø–æ—Å–æ–±–µ–Ω –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ —Å–ª–æ–∂–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã, –∫–æ–º–±–∏–Ω–∏—Ä—É—è –∏–∑–≤–ª–µ—á—ë–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ LLM (Gemma).

## üìå –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üì• –ó–∞–≥—Ä—É–∑–∫–∞ –∏ —Ä–∞–∑–±–æ—Ä PDF-–¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.
- üñºÔ∏è –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü –≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (`pdf2image`) –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ (`pypdf`).
- üîé –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –ø–æ–º–æ—â—å—é –º–æ–¥–µ–ª–∏ `ColPali`.
- üíæ –°–∂–∞—Ç–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –≤ –≤–µ–∫—Ç–æ—Ä–Ω—É—é –±–∞–∑—É Vespa.
- ü§ñ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∞–≥–µ–Ω—Ç: –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å, –∏—â–µ—Ç –ø–æ –±–∞–∑–µ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç —á–µ—Ä–µ–∑ Gemma (via Ollama).

---

## ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```bash
pip install colpali-engine==0.3.1 vidore_benchmark==4.0.0 pdf2image google-generativeai pypdf==5.0.1 pyvespa vespacli requests
```

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `poppler` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã `pdf2image`:

```bash
# Ubuntu
sudo apt install poppler-utils
# MacOS (—á–µ—Ä–µ–∑ Homebrew)
brew install poppler
```

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å –º–æ–¥–µ–ª—å ColPali:

```python
from colpali_engine.models import ColPali, ColPaliProcessor
model = ColPali.from_pretrained("vidore/colpali-v1.3")
processor = ColPaliProcessor.from_pretrained("vidore/colpali-v1.3")
```

2. –°–∫–∞—á–∞–π—Ç–µ –∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É–π—Ç–µ PDF:

```python
from pdf2image import convert_from_path
from pypdf import PdfReader
```

3. –ò–∑–≤–ª–µ–∫–∏—Ç–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ —Å—Ç—Ä–∞–Ω–∏—Ü, –∏—Å–ø–æ–ª—å–∑—É—è `ColPali`.

4. –ó–∞–ø–∏—à–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç Vespa JSON –∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –≤ –∑–∞–ø—É—â–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä Vespa.

5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–º—É –∑–∞–ø—Ä–æ—Å—É –∏ –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å –ø–æ–º–æ—â—å—é `Gemma` –∏ `Ollama`.

---

## üì¶ –ó–∞–ø—É—Å–∫ Vespa –ª–æ–∫–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ Docker

```bash
docker run -d --name vespa -m 4g --cpus=2 \
  -p 8080:8080 -p 19071:19071 \
  -v /path/to/visionrag:/vespa-app \
  vespaengine/vespa:8
docker exec vespa vespa-deploy prepare /vespa-app
docker exec vespa vespa-deploy activate
```

---

## üß† –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞

```python
user_q = "–æ–ø–∏—Å–∞–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ Apriori –∏ –∫–∞–∫ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å support, confidence –∏ lift"
process_query_with_gemma_vespa(user_q)
```

Gemma –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–π —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å—Ç—Ä–∞–Ω–∏—Ü, –∏–∑–≤–ª–µ—á—ë–Ω–Ω—ã—Ö –∏–∑ PDF.

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

- `agent.ipynb` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –Ω–æ—É—Ç–±—É–∫, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –ø–∞–π–ø–ª–∞–π–Ω –æ—Ç –∑–∞–≥—Ä—É–∑–∫–∏ PDF –¥–æ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –∑–∞–ø—Ä–æ—Å.
- `ColPali`, `pdf2image`, `pypdf` ‚Äî –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏ —Å–æ–∑–¥–∞–Ω–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤.
- `vespa.application`, `pyvespa` ‚Äî –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ö–µ–º—ã, –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –ø–æ–∏—Å–∫–∞ –≤ Vespa.
- `Ollama + Gemma` ‚Äî –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.

---

## üìå –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –î–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω—ã–π Ollama —Å –º–æ–¥–µ–ª—å—é `gemma3:4b-it-q4_K_M`.
- –í—Å–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å –Ω–∞ GPU, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ.
- –ë–∏–Ω–∞—Ä–∏–∑–∞—Ü–∏—è –≤–µ–∫—Ç–æ—Ä–æ–≤ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —Å–Ω–∏–∑–∏—Ç—å –æ–±—ä—ë–º —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ —É—Å–∫–æ—Ä–∏—Ç—å –ø–æ–∏—Å–∫.

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏–∏

- ColPali: HuggingFace + Vidore
- Vespa: Apache License 2.0
- Gemma: [—É—Å–ª–æ–≤–∏—è –æ—Ç Google](https://ai.google.dev/gemma/terms)
